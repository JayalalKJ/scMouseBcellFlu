---
title: "Trajectory Inference Report"
author: "Jonathan Robinson"
date: "`r Sys.Date()`"
output:
  html_document:
    fig_caption: yes
    toc: no
  pdf_document:
    toc: yes
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, results = 'hide', fig.width=10)
```

```{r}
# specify relevant directory information
pdir <- '/Users/jonrob/Documents/NBIS/LTS_projects/d_angeletti_1910/'  # parent directiory
adir <- paste0(pdir,'analysis/')  # analysis subdirectory
ddir <- paste0(pdir,'data/')  # data subdirectory
sdir <- paste0(adir,'04_cluster/cell_type_prediction/')  # cell type prediction subdirectory
tdir <- paste0(adir,'06_trajectory/')  # trajectory subdirectory
```

```{r}
# load libraries
library(knitr)
```

# {.tabset}

## Cell type markers {.tabset}

### B-cell types

#### Correlation of cells with B-cell subtype marker genes
```{r, results='asis'}
cat('![](', sdir, 'bcell_types/UMAP_cell_type_correlation.png', ')', sep='')
```

<br/><br/>

#### Table of cell-type marker genes used for prediction
```{r, results='asis'}
gene_table <- read.csv(paste0(ddir,'gene_lists/bcell_types.csv'))
kable(gene_table)
```


### Germinal center subtypes
#### Correlation of cells with B-cell GC subtype marker genes
```{r, results='asis'}
cat('![](', sdir, 'bcell_types_germsub_zonesub/UMAP_GC_cell_type_correlation.png', ')', sep='')
```

<br/><br/>

#### Table of cell-type marker genes used for prediction
```{r, results='asis'}
gene_table <- read.csv(paste0(ddir,'gene_lists/bcell_types_germsub_zonesub.csv'))
gene_table <- gene_table[, startsWith(colnames(gene_table), 'GC')]
kable(gene_table)
```


## Diffusion map reduction
#### UMAP and Diffusion map components (DCs), colored by cluster identity
```{r, results='asis'}
cat('![](', tdir, 'diffusion_map_components.png', ')', sep='')
```

## Trajectory lineages and curves
#### Parameters: Starting cluster = #1, Ending clusters = auto

<br/>

#### Trajectory lineages
```{r, results='asis'}
cat('![](', tdir, 'trajectory_lineages.png', '){width=70%}', sep='')
```

#### Trajectory curves
```{r, results='asis'}
cat('![](', tdir, 'trajectory_curves.png', '){width=70%}', sep='')
```


<!-- ## Top genes: all lineages combined {.tabset} -->

<!-- ### Pseudotime -->
<!-- #### Top gene associated with pseudotime -->
<!-- ```{r, results='asis'} -->
<!-- cat('![](', tdir, 'top_pseudotime_assoc_gene_umap.png', '){width=50%}', sep='') -->
<!-- cat('![](', tdir, 'top_pseudotime_assoc_gene_traject_expr.png', '){width=50%}', sep='') -->
<!-- ``` -->

<!-- ### Start vs. End -->
<!-- #### Top gene DE between trajectory start and end point -->
<!-- ```{r, results='asis'} -->
<!-- cat('![](', tdir, 'top_start_end_assoc_gene_umap.png', '){width=50%}', sep='') -->
<!-- cat('![](', tdir, 'top_start_end_assoc_gene_traject_expr.png', '){width=50%}', sep='') -->
<!-- ``` -->

<!-- ### Early lineage differences -->
<!-- #### Top gene associated with early differences between lineages -->
<!-- ```{r, results='asis'} -->
<!-- cat('![](', tdir, 'top_early_diff_assoc_gene_umap.png', '){width=50%}', sep='') -->
<!-- cat('![](', tdir, 'top_early_diff_assoc_gene_traject_expr.png', '){width=50%}', sep='') -->
<!-- ``` -->


## Lineage-associated genes {.tabset}
```{r, results='asis'}
umap_names <- dir(tdir, 'curve._assoc_gene_umap[.]png')
pexp_names <- dir(tdir, 'curve._assoc_gene_traject_expr[.]png')
for (L in 1:length(umap_names)) {
  cat('### Lineage', L, '{.tabset} \n')
  
  cat('#### Expression on UMAP \n')
  cat('##### Top 6 genes associated with lineage', L, '\n')
  cat('![](', tdir, umap_names[L], ') \n\n', sep='')
  
  cat('#### Expression vs. Pseudotime \n')
  cat('##### Top 6 genes associated with lineage', L, ' \n')
  cat('![](', tdir, pexp_names[L], ') \n\n', sep='')
}
```








