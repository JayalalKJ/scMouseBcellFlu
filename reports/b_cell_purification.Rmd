---
title: "Angeletti Data Analysis Report"
author: "Jonathan Robinson"
date: "`r Sys.Date()`"
output:
  html_document:
    fig_caption: yes
    toc: no
  pdf_document:
    toc: yes
editor_options: 
  chunk_output_type: console
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, results = 'hide', fig.width=8)
```

```{r}
# specify relevant directory information
pdir <- '/Users/jonrob/Documents/NBIS/LTS_projects/2020_DAngeletti/'  # parent directiory
adir <- paste0(pdir,'analysis/')  # analysis subdirectory
ddir <- paste0(pdir,'data/')  # data subdirectory
```

```{r}
# load libraries and source functions
library(knitr)
# source('/Users/jonrob/Documents/NBIS/repos/niceRplots/R/plotting_functions.R')
```

# Purification of B-Cells {.tabset}

## Pass 1 {.tabset}
```{r}
# specify parameters
cdir <- paste0(adir,'02_cluster/')
edir <- paste0(adir,'03_diff_expr/')
clust <- 'HC_12'
```

### Dimensionality reduction

```{r, results='asis'}
metadata_fields <- c('organ','infection','day_post_infection')
for (mf in metadata_fields){
  cat('#### UMAP: colored by', unlist(strsplit(mf,'_')))
  cat('![](', cdir, 'umap_plots/umap_metadata_', mf, '.png', '){width=80%}\n', sep='')
}
```

### Clustering

```{r, results='asis'}
cat('#### UMAP with mapped hierarchical cluster groups (', clust, ')', sep='')
cat('![](', paste0(cdir,'clustering/clustering_', clust, '_umap.png'), '){width=80%}', sep='')
```

### Differential expression

#### Expression of top 3 DE genes per cluster
```{r, results='asis'}
cat('![](', paste0(edir,'violinPlot_genes_per_cluster_top3.png'), ')', sep='')
```

### Cell type prediction

#### UMAP with mapped predicted (based on correlation) cell types for each cluster
```{r, results='asis'}
cat('![](', paste0(cdir,'cell_type_prediction/main_cell_types/cell_cluster_pred_correlation_umap.png'), '){width=80%}', sep='')
```

#### Table of cell-type specific genes used for prediction
```{r, results='asis'}
gene_table <- read.csv2(paste0(ddir,'cell_markers/main_cell_types.csv'))
kable(gene_table)
```



## Pass 2 {.tabset}
```{r}
# specify parameters
cdir <- paste0(adir,'04_cluster/')
edir <- paste0(adir,'05_diff_expr/')
clust <- 'HC_15'
```

### Dimensionality reduction

```{r, results='asis'}
metadata_fields <- c('organ','infection','day_post_infection')
for (mf in metadata_fields){
  cat('#### UMAP: colored by', unlist(strsplit(mf,'_')))
  cat('![](', cdir, 'umap_plots/umap_metadata_', mf, '.png', '){width=80%}\n', sep='')
}
```

### Clustering

```{r, results='asis'}
cat('#### UMAP with mapped hierarchical cluster groups (', clust, ')', sep='')
cat('![](', paste0(cdir,'clustering/clustering_', clust, '_umap.png'), '){width=80%}', sep='')
```

### Differential expression

#### Expression of top 3 DE genes per cluster
```{r, results='asis'}
cat('![](', paste0(edir,'violinPlot_genes_per_cluster_top3.png'), ')', sep='')
```

### Cell type prediction

#### UMAP with mapped predicted (based on correlation) cell types for each cluster
```{r, results='asis'}
cat('![](', paste0(cdir,'cell_type_prediction/main_cell_types/cell_cluster_pred_correlation_umap.png'), '){width=80%}', sep='')
```

#### Table of cell-type specific genes used for prediction
```{r, results='asis'}
gene_table <- read.csv2(paste0(ddir,'cell_markers/main_cell_types.csv'))
kable(gene_table)
```



## Pass 3 {.tabset}
```{r}
# specify parameters
cdir <- paste0(adir,'06_cluster/')
edir <- paste0(adir,'07_diff_expr/')
clust <- 'HC_11'
```

### Dimensionality reduction

```{r, results='asis'}
metadata_fields <- c('organ','infection','day_post_infection')
for (mf in metadata_fields){
  cat('#### UMAP: colored by', unlist(strsplit(mf,'_')))
  cat('![](', cdir, 'umap_plots/umap_metadata_', mf, '.png', '){width=80%}\n', sep='')
}
```

### Clustering

```{r, results='asis'}
cat('#### UMAP with mapped hierarchical cluster groups (', clust, ')', sep='')
#
cat('![](', paste0(cdir,'clustering/clustering_', clust, '_umap.png'), '){width=80%}', sep='')
```

### Differential expression

#### Expression of top 3 DE genes per cluster
```{r, results='asis'}
cat('![](', paste0(edir,'violinPlot_genes_per_cluster_top3.png'), ')', sep='')
```

### Cell type prediction

#### UMAP with mapped predicted (based on correlation) cell types for each cluster
```{r, results='asis'}
cat('![](', paste0(cdir,'cell_type_prediction/main_cell_types/cell_cluster_pred_correlation_umap.png'), '){width=80%}', sep='')
```

#### Table of cell-type specific genes used for prediction
```{r, results='asis'}
gene_table <- read.csv2(paste0(ddir,'cell_markers/main_cell_types.csv'))
kable(gene_table)
```




